<html>
    <head>
        <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
        <script defer src="https://pyscript.net/latest/pyscript.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">    
    </head>
    <body>
        <py-config>
            packages = ["numpy", "pandas", "folium", "requests"]
        </py-config>

        <py-script>
            import pandas as pd
            import numpy as np 
            import requests
            import json            
            
            #%% read URL
            url = "https://archive.sgc.gov.co/feed/v1.0/notifications/notifications.json"
            response = requests.get(url)
            json_data = json.loads(response.content)
            
            # %%
            notifications_list = json_data['notifications']
            #%%
            import folium

            ## Datos 
            #volcanes = [
            #    {
            #        'name': 'Volcán Nevado del Huila',
            #        'lat': 2.924,
            #        'lon': -76.029,
            #        'popup': "<strong>Volcán Nevado del Huila</strong><br>ID: 1<br>Latitud: 2.924<br>Longitud: -76.029",
            #    },
            #    {
            #        'name': 'Volcán Puracé',
            #        'lat': 2.313,
            #        'lon': -76.395,
            #        'popup': "<strong>Volcán Puracé</strong><br>ID: 2<br>Latitud: 2.313<br>Longitud: -76.395",
            #    }
            #]

            volcanes =notifications_list[1]["properties"]
            #%%
            # Crear el mapa
            mapa = folium.Map(location=[notifications_list[1]["properties"]["latitude"], notifications_list[1]["properties"]["longitude"]], zoom_start=8)

            #%%
            # Añadir marcadores de los volcanes
            for volcan in notifications_list:
                if volcan['type'] == 'volcano':
                    volcan = volcan["properties"]
                    folium.Marker(
                        [volcan['latitude'], volcan['longitude']],
                        popup=f"<h5>{volcan['VolcanoName']}</h5><br><a target='_blank' href='{volcan['bulletins'][0]['file']}'>Boletin</a>",
                        icon=folium.Icon(color='red', icon='info-sign')
                    ).add_to(mapa)
                elif volcan['type'] == 'earthquake':
                    volcan['latitude'] = volcan['geometry']['coordinates'][0]
                    volcan['longitude'] = volcan['geometry']['coordinates'][1]
                    folium.Marker(
                        [volcan['latitude'], volcan['longitude']],
                        popup=f"<h5>{volcan['properties']['place']}</h5><br><b>{volcan['properties']['mag']}</b>",
                        icon=folium.Icon(color='blue', icon='info-sign')
                    ).add_to(mapa)
                    
                
            # Guardar el mapa como un archivo HTML
            mapa.save('mapa_volcanes.html')
        </py-script>
        <div>
            <div class="container text-center">
                <div class="row">
                  <div class="col-3">
                      <img height="100" src="https://www.epa.gov.co/images/carpeta2020/LOGO_SUPERSERVICIOS.png" alt="Descripción de la imagen">
                  </div>
                  <div class="col-6 d-flex align-items-center justify-content-center">
                      <h1>Tablero de Eventos Geol&oacute;gicos</h1>
                  </div>
                  <div class="col-3">
                      <img height="100" src="https://cloudfront-us-east-1.images.arcpublishing.com/infobae/64X4LLC74RAALO73H3CBRWGI2A.png" alt="Descripción de la imagen">
                  </div>
                </div>
              </div>
            <div width="100%">
                <iframe width="100%" height="90%" src="mapa_volcanes.html"/>
            </div>
        </div>
    </body>
</html>